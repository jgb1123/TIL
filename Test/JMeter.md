# JMeter
## JMeter?
* Apache에서 만든 자바로 만들어진 웹 어플리케이션 부하 테스트 오픈소스이다.
### 부하 테스트?
* 해당 하드웨어 및 네트워크 환경에서 얼마나 많은 사용자가 동시에 사용할 수 있는지 테스트하는 것이다.

### 장점
* Apache에서 만든 오래된 툴로, 유명하고 자료가 많다.
* 다양한 프로토콜을 지원한다.
* GUI, email, DB, SSL 등 지원하는 기능과 플로그인이 많다.
* 시나리오 기반 테스트가 가능하다.

### 단점
* 결과는 리스너로 만들어 보는데, 모니터링이 불편하다.
  * 많은 리스너가 존재할 경우 설정을 일일이 해줘야 해서 귀찮다.
* 스레드 기반이라 성능 제약이 있다.

## 설치
* [Apache Jmeter 다운로드 페이지](https://jmeter.apache.org/download_jmeter.cgi)에서 설치를 한다.
* 압축을 푼 폴더 아래 bin폴더로 가서 jmeter실행하면 GUI가 나타난다.

## JMeter 용어
### Thread Group
* Thread Group은 모든 테스트 플랜 작성의 시작 지점으로, Thread Group 아래에 모든 컨트롤러와 샘플러가 위치한다.
* Thread Group에 실행하는 쓰레드 수, 램프업 시간, 테스트 수행 시간을 지정한다.
* 하나의 테스트 플랜에는 여러개의 Thread Group을 지정할 수 있다.

### Sampler
* JMeter가 대상 시스템에 요청해야 하는 정보를 설정한다.
* HTTP 프로토콜을 이용해 테스트한다면 HTTP RequestSampler를 추가하고, URL정보와 파라미터 값들을 설장한다.
* 각 샘플러는 해당 프로토콜에 맞는 속성값들을 정의하게 되어있고, 테스트 시 해당 프로토콜에 대한 이해 없이는 설정이 어렵다.

## Logical Controllers
* JMeter가 언제 서버에 요청을 전달할지를 결정한다.
* HTTP URL이 2개이고, 해당 요청의 순서가 존재한다면 HTTP Request Sampler를 2개 등록하고 Logical Controller 2개로 상관관계를 정의할 수 있다.

### Listener
* JMeter를 통해 테스트한 결과 정보나 상태 정보를 표시한다.
* 일반적으로는 Graph Result를 이용해 진행되는 추이를 그래프로 확인한다.
* 수집된 정보는 XML, CSV로도 저장이 가능하다.

### Timers
* JMeter의 테스트 플랜에 샘플러를 등록하면 순차적으로 진행이 되지만, 실제 사용자들이 요청을 순차적으로 매우 빠른 시간내에 수행하는것은 불가능하다.
* 따라서 요청과 요청 사이에 특정한 시간 간격을 두려면 Timers를 이용해 설정할 수 있다.

### Assertion
* JMeter의 HTTP 프로토콜을 이용해 성능 테스트를 할 경우, 요청별 성공/실패 여부는 HTTP 응답코드의 값을 이용해 판단한다.
* HTTP 응답코드가 200번대면 성공, 그외에 다른 코드값들은 실패이며, JMeter에서도 이와 같이 200번대 코드가 리턴되면 테스트는 성공이다.
* 하지만 200번대 코드가 리턴되더라도 실패로 판단해야 하는 경우도 많이 있으므로, 이 경우 Assertion을 이용해 응답 정보에 특정한 메시지를 필터링해 성공/실패 여부를 판단할 수 있다.

### Configuration Elements
* 직접적으로 요청을 수행하지는 않지만 샘플러의 요청 정보를 관리할 수 있다.
* 예시로, 테스트 플랜이 복잡해 HTTP Request Sampler 작성을 많이 해야 하는데 서버 IP나 포트와같이 공통적으로 많이 사용되는 부분이 있다면 Configuration Elements의 HTTP Request Defaults에 설정하면 된다.
  * 해당 설정 정보가 관련된 HTTP Request에 모두 적용된다.

### Pre-Processor Elements
* 샘플러를 실행하기 전에 수행해야 할 내용을 정의한다.
* 요청을 하기 전에 파라미터 값을 초기화를 하는 것과 같은 작업에 사용한다.

### Post-Processor Elements
* 샘플러를 실행한 후에 수행해야 할 내용을 정의한다.

### 우선순위
* 위와같은 항목들은 JMeter 실행 시 우선순위가 존재한다.
* Configuration -> Pre-Processor -> Timer -> Sampler -> Post-Processor -> Assertion -> Listener
* JMeter가 테스트를 수행할 때 작성된 테스트 플랜과 Thread Group에 정의되어 있는 내용 중 위의 순서규칙을 참조해 동작한다.
* 이와같은 개념을 정확히 이해해야 정확한 결과를 얻을 수 있다.

## Test Plan 설정
* Test Plan의 이름과 설명이 영향을 주지는 않지만, 향후 여러 버전이나 여러 대상 애플리케이션을 작업해야 한다면 이름과 설명을 제대로 작성하는 것이 좋다.
* 추가적으로 실행에 직접적으로 영향을 주는 옵션이 제공되는데, 일반적으로는 잘 사용은 하지 않지만 알고는 있으면 좋다.

### User Defined Variables
* 변수 선언이 필요할 때 사용한다.
* 테스트 전반에 걸쳐서 선언한 변수와 값을 이용할 수 있다.

### Run Thread Groups consecutively
* Test Plan에 여러 개의 Thread Group이 있는 경우, 이 옵션을 사용하면 병렬로 동작하는 것이 아니라 순차적으로 실행된다.

### Run tearDown Thread Groups after shutdown of main threads
* 테스트를 종료한 후 후속 테스트를 수행하도록 설정할 수 있다.
* 이 기능을 사용하기 위해선 별도의 tearDown Thread Group을 설정해야 한다.

### Functional Test Mode
* 이 옵션을 사용하면 테스트 시 서버로부터 응답받은 데이터를 JMeter가 저장한다.
* 파일 Listener를 Test Plan에 추가한 경우 응답 데이터를 파일에 저장할 수 있고, 저장된 데이터를 보며 정상적으로 Test Plan이 작성되었는지 확인할 수 있다.
* 하지만 이 옵션은 JMeter의 성능에 큰 영향을 주기 때문에 실제 테스트시에는 사용하지 않는다.
  * 이 옵션은 작성한 성능 테스트 모델을 검증하기 위해서만 종종 사용한다.
  * 응답 데이터를 저장하고 해당 저장된 내용이 원하는대로 잘 처리되고 전달되었는지를 검증할 용도로 사용한다.

### Add directory or jar to classpath
* Test Plan에 사용할 JAR 혹은 디렉토리를 클래스 패스에 추가하는 것으로, 주로 데이터베이스 드라이버나 JMS 클라이언트 등을 사용한다.

## Test Group 설정 (부하 발생 시간 및 스레드 설정)
* Test Group에는 반드시 하나 이상의 Thread Group이 있어야 한다.
* 애플리케이션의 동시 사용자가 10명이라면 쓰레드 수는 10을 설정해야 하고, 이 수만큼 쓰레드를 생성해 부하를 발생시킨다.

### Number of Threads
* 사용자 수를 의미하며 해당 값만큼 JMeter가 쓰레드를 생성해 요청을 수행한다.

### Ramp-up Period
* 정확한 테스트를 위해 초기에 일정 시간동안 준비하는 시간을 의미한다.
* Ramp-up 시간이 100초이고 쓰레드 수가 2면 50초에 쓰레드가 하나씩 증가한다.

### Loop Count
* 쓰레드당 수행할 테스트 횟수를 의미한다.
* 쓰레드 수가 3이고, Loop Count가 1000이라면 3000번동안 Thread Group을 반복해서 실행한다.
* 만약 Forever에 체크하면 사용자가 종료할 때까지 계속 실행한다.

### Scheduler
* 테스트에 대한 스케줄링 시간을 설장한다.

### 쓰레드 수 설정 팁
* 초기에는 쓰레드 사용자를 1로 시작해서 점차 늘려가는 것이 좋다.
* 처음부터 너무 큰 값을 설정하면 애플리케이션 부하도 많이 걸리고 정확한 테스트 수치를 얻기 힘들다.
* 따라서 작은 값부터 시작해 조금씩 늘려가며 증가시킨 만큼 처리 성능이 늘어나는지 확인하고, 만일 더이상 늘어나지 않거나 오히려 줄어들 경우 해당 애플리케이션의 한계라고 생각하면 된다.

## Config Element(환경변수 설정)
* Config Element는 샘플러와 밀접하게 연관된 것으로 추가하고자 하는 샘플러에 공통적인 설정 정보를 제공한다.
* 가장 대표적인 것은 테스트할 애플리케이션의 IP와 포트정보이다.
* 많은 샘플러를 등록해야 한다면 Config Element를 통해 공통 정보를 설정해 두는 것이 유용하다.
* 예시로 HTTP Request Defaults의 경우 테스트 플랜에 추가할 수도 있고 쓰레드 그룹에 추가할 수도 있는데 추가하는 곳의 위치에 따라 HTTP Request Defaults의 적용범위가 결정된다.
  * 쓰레드 그룹에 추가하였다면 해당 쓰레드 그룹에 정의되어있는 HTTP Request에만 적용된다.

## Sampler(테스트 대상 설정)
* 쓰레드 그룹을 생성한 다음 할 일은 샘플러를 추가하는 일이다.
* 요청할 Server Name 혹은 IP와 포트번호를 기입하고, POST 혹인 GET으로 전달할 파라미터 값을 Parameters에 기입하면 된다.
* 추가적으로 테스트할 내용이 있다면 계속해서 쓰레드 그룹에 HTTP Request 샘플러를 추가하면 되고, 샘플러 설정이 완료되었으면 JMeter를 통해 바로 부하테스트를 시작할 수 있으며, 이외에도 몇가지 설정할 수 있다.
