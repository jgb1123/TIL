#CI/CD

## CI/CD?
* 코드 버전 관리를 하는 VCS 시스템(Git, SVN 등)에 PUSH가 되면 자동으로 테스트와 빌드가 수행되어 안정적인 배포파일을 만드는 과정을 CI(Continuous Integration)라고 한다.
* 이 빌드 결과를 자동으로 운영 서버에 무중단 배포까지 진행되는 과정을 CD(Continuous Deployment)라고 한다.
* 일반적으로는 CI만 구축되어 있지는 않고 CD까지 함께 구축된 경우가 대부분이다.

### CI/CD 등장 배경
* 현대 웹 서비스 개발에서는 하나의 프로젝트를 여러 개발자가 함께 개발을 진행한다.
* 각자가 개발한 코드가 합쳐야 할 때마다 많은 일을 해야했고, 실제로 매주 병합일을 정해서 이날은 코드를 합치는 일만 하기도 했다.
* 이런 수작업 때문에 생산성이 좋을 수가 없었고, 개발자들은 지속해서 코드가 통합되는 환경(CI)을 구축하게 되었다.
* 개발자가 각자 원하는 저장소로 푸시가 될 때마다 코드를 병합하고, 테스트 코드와 빌드를 수행하면서 자동으로 코드가 통합되어 더는 수동으로 코드를 통합할 필요가 없어졌으며, 개발자들은 개발에만 집중할 수 있게 되었다.
* CD 역시 마찬가지로 수십 대 수백 대의 서버에 개발자가 수동으로 배포를 해야 하는 상황이 오면서 더는 수동으로 배포할 수가 없어졌다.
* 따라서 이 또한 자동화하게 되었고, 마찬가지로 개발자들이 개발에만 집중할 수 있게 되었다.

### 고려 사항
* CI 도구를 도입했다고 해서 CI를 하고 있는 것은 아니다.
* 마틴 파울러는 CI에 대해 다음과 같은 4가지 규칙을 이야기한다.
  * 모든 소스 코드가 살아있고 누구든 현재의 소스에 접근할 수 있는 단일 지점을 유지할 것
  * 빌드 프로세스를 자동화해서 누구든 소스로부터 시스템을 빌드하는 단일 명령어를 사용할 수 있게 할 것
  * 테스팅을 자동화해서 단일 명령어로 언제든지 시스템에 대한 건전한 테스트 수트를 실행할 수 있게 할 것
  * 누구나 현재 실행 파일을 얻으면 지금까지 가장 완전한 실행 파일을 얻었다는 확인을 하게 할 것
* 지속적으로 통합하기 위해서 무엇보다 중요한 것은, 이 프로젝트가 완전한 상태임을 보장하기 위해 테스트 코드가 구현되어 있어야만 한다.

## CI/CD 툴
### 설치형 CI/CD 툴(Jenkins)
* 설치형 CI/CD 툴은 대표적으로 젠킨스(Jenkins)가 있다.
* 젠킨스는 개인 컴퓨터나 서비스가 실행되는 서버에 직접 다운로드하여 설치하여 사용한다.
* 윈도우, 맥, 리눅스에 모두 설치 가능하며, 젠킨스를 설치 후 실행하면 해당 컴퓨터나 서버의 주소로 크롬 등의 브라우저를 통해 접속할 수 있는 웹사이트가 열린다.
  * 서버의 아이피 주소의 젠킨스 기본포트 8080으로 접속하고, 지정한 아이디와 비밀번호를 입력하면 다양한 CI/CD 작업을 세팅할 수 있는 페이지가 표시되며, 이 웹사이트가 CI/CD를 설정하기 위한 작업 콘솔이다.
* 젠킨스에 새 자동화 작업을 생성하고 이를 Github, BitBucket, GitLab 등 프로젝트를 저장하는 서비스 계정에 연동을 한다.
  * 이 Github 저장소의 특정 Branch에 소스가 Push 될 때마다 젠킨스에서 이 서버로 코드들을 자동으로 젠킨스 전용 폴더로 다운로드 하게 된다.
* 코딩 작업을 하고, Github에 Push를 하면 젠킨스가 설치된 서버로 전송이 된다.
* 그러면 그 다음에 처리할 행동들을 정의하면 되고, 먼저 Github에서 가져온 코드에 문제가 없는지 테스트 코드에 지정된 테스트를 돌려서 확인하도록 만들면 된다.
  * Gradle을 사용하는 프로젝트라면 받아온 코드에 Gradle 명령어로 테스트를 수행하도록 할 수 있다.
  * 만약 테스트가 실패할 경우, 지정된 메일 주소로 이메일을 보내거나 슬랙 등으로 메시지를 전송하여 개발자에게 바로 알려줄 수 있다.
* 이전 작업들에 문제가 없다면 실행되도록 설정한 다음 작업들에서 프로젝트를 배포용 파일로 빌드한 다음 원하는 폴더로 옮겨서 실행되고 있던 서비스를 중지하고 이 파일로 새 서비스를 실행하는 명령어를 스크립트로 실행되도록 한다.
* 즉, 개발자는 코딩을 한 후 Git에 Push하기만 하면 서버로 옮겨서 테스트하고, 문제가 없을경우 빌드해서 배포하며 테스트 실패 시 보고하는 것도 포함하여 젠킨스가 다 알아서 해주게 된다.
* 젠킨스의 플러그인은 무궁무진하며, 플러그인을 잘 활용하면 AWS에 연동하여 도커 컨테이너로 올려주거나, 다수의 작업을 파이프라인으로 체계화 하거나, 젠킨스 화면도 꾸밀 수 있다.
* 젠킨스는 오픈소스이므로 무료로 사용 가능하다.
* 하지만 설치형이기 때문에, 이를 위한 EC2 인스턴스가 하나 더 필요하다.

### 클라우드형 CI/CD 툴(Travis CI, Circle CI, Team City)
* 젠킨스처럼 설치형으로 쓸 수 있지만, 기본적으로 클라우드로 제공한다.
* 클라우드에서 자동화 작업을 설정할 수 있으며, 사용 방법은 젠킨스와 비슷하다.
  * Github 등의 Git 저장소 계정과 연동하고 Repository 중 CI/CD를 진행할 프로젝트를 선탠하고 자동화로 처리할 작업을 세팅한다.
* Travis로 예를 들면, 프로젝트 최상위 폴더에 .travis.yml이라는 파일을 만들고 Travis에서 지정한 형식대로 어떤 작업들을 진행할지 작성하면 된다. (다른 CI/CD툴도 비슷함)
* 지정한 Branch에 Push가 들어오면 코드를 Github로부터 Travis의 서버로 가져와서 테스트를 한 후 성공이나 실패 여부를 이메일로 보내도록 만든다.
* 이름만 보면 CI만 된다고 생각할 수 있지만, CD도 가능하다.
* 이 클라우드 서비스는 유료이거나 제한적 무료이다. (가볍게는 무료로 이용할 수 있지만 상업용으로 넘어가면 이용료 발생)


___
참고

이동욱, 스프링 부트와 AWS로 혼자 구현하는 웹 서비스

https://ssonny.tistory.com/entry/CICD%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80

